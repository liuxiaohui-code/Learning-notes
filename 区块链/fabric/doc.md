# fabric 特点

	1. 第一个支持**通用编程语言编写智能合约**（如 Java、Go 和 Node.js）的分布式账本平台，不受限于特定领域语言（Domain-Specific Languages，DSL）
	1. Fabric 平台也是**许可的**
	1. 支持**可插拔的共识协议**
	1. 利用**不需要原生加密货币**的共识协议来激励昂贵的挖矿或推动智能合约执行
	1. 这些差异化设计特性的结合使 Fabric 成为当今交易处理和交易确认延迟方面**性能较好的平台**之一，并且它实现了交易的**隐私和保密**以及智能合约（Fabric 称之为“链码”）。

## 模块化

- 可插拔的*排序服务*对交易顺序建立共识，然后向节点广播区块；
- 可插拔的*成员服务提供者*负责将网络中的实体与加密身份相关联；
- 可选的*P2P gossip 服务*通过排序服务将区块发送到其他节点；
- 智能合约（“链码”）隔离运行在容器环境（例如 Docker）中。它们可以用标准编程语言编写，但不能直接访问账本状态；
- 账本可以通过配置支持多种 DBMS；
- 可插拔的背书和验证策略，每个应用程序可以独立配置。

## 许可链与非许可链

在一个**非许可区块链**中，几乎任何人都可以参与，每个参与者都是匿名的。

**许可区块链**在一组已知的、已识别的且经常经过审查的参与者中操作区块链，这些参与者在产生一定程度信任的治理模型下运作。许可区块链提供了一种方法来保护具有共同目标，但可能彼此不完全信任的一组实体之间的交互。通过依赖参与者的身份，许可区块链可以使用更传统的崩溃容错（CFT）或拜占庭容错（BFT）共识协议，而不需要昂贵的挖掘。

# 共识协议

[崩溃容错](https://en.wikipedia.org/wiki/Fault_tolerance)（Crash Fault-Tolerant，CFT）共识协议

[拜占庭容错](https://en.wikipedia.org/wiki/Byzantine_fault_tolerance)（Byzantine Fault Tolerant，BFT）共识协议。

# 排序节点

## raft

​	Raft 是一种基于 [`etcd`](https://coreos.com/etcd/) 中 [Raft 协议](https://raft.github.io/raft.pdf)实现的崩溃容错（Crash Fault Tolerant，CFT）排序服务。Raft 遵循“领导者跟随者”模型，这个模型中，在每个通道上选举领导者节点，其决策被跟随者复制。Raft 排序服务会比基于 Kafka 的排序服务更容易设置和管理，它的设计允许不同的组织为分布式排序服务贡献节点。



三种状态： 跟随者、候选者、领导者

​	所有节点开始于跟随者，如果追随者没有听到领导的声音，那么他们可以成为候选人。然后候选节点向其他节点请求投票。节点将以投票的方式回应。如果候选人获得了大多数节点的投票，那么它将成为leader。这个过程被称为领导人选举。

​	对系统的所有更改现在都要经过leader。

​	client向raft leader发送一个日志项目要提交条目 5，节点首先将其复制到跟随节点…，该日志项目前未提交，因此不会更新节点的值。然后leader等待，直到大多数节点都写入了这个条目。条目现在被提交到领导节点上，节点状态为“5”。然后leader通知follower条目已经提交。集群现在已经就系统状态达成了共识。这个过程称为日志复制。

​	在Raft中有两个控制选举的超时设置。

​	选举超时时间：选举超时时间是追随者在成为候选人之前等待的时间。选举超时被随机分配到150ms到300ms之间。选举超时后，追随者成为候选人，开始新的选举任期….．.为自己投票…….．.并向其他节点发送请求投票消息。如果接收节点在这个期限内还没有投票，那么它将投票给候选人….．.节点将重置其选举超时时间。一旦候选人获得多数选票，就成为领袖。

​	心跳超时时间：leader开始向follower发送Append Entries消息。这些消息按照心跳超时指定的时间间隔发送。追随者然后响应每个Append Entries消息。这一选举任期将持续到追随者停止心跳成为候选人为止。需要获得多数选票才能保证每一届只能选出一名领导人。

​	日志复制，这是通过使用与心跳相同的Append Entries消息来完成的。client向leader发送状态6，在下一个心跳时间后，leader将日志项目发送到他的跟随者，跟随者返回leader更新消息，leader接收到大多数追随者已经更新日志项目后，提交日志项目，将日志项目发送给client，并在下一个心跳时间间隔，通知追随者状态已提交，更新状态；

两种事件： 心跳时间

跟随者：在一个心跳时间间隔中没有收到消息，将转变为候选者；接收到消息重置心跳时间

候选者：向其他节点发送投票，超过半数则转变为领导者；

领导者：

## kafka

​	在 v2.0 中被弃用

​	和基于 Raft 的排序类似，Apache Kafka 是一个 CFT 的实现，它使用“领导者和跟随者”节点配置。Kafka 利用一个 ZooKeeper 进行管理。基于 Kafka 的排序服务从 Fabric v1.0 开始就可以使用，但许多用户可能会发现管理 Kafka 集群的额外管理开销令人生畏或不受欢迎。

## solo

​	在 v2.0 中被弃用

​	排序服务的 Solo 实现仅仅是为了测试，并且只包含了一个单一的排序节点。它已经被弃用了，可能会在将来的版本中被完全移除。既存的 Solo 用户应该迁移到一个单一节点的 Raft 网络获得同样的功能。

​	可以使用 一个排序节点的 raft 共识代替 solo；
