# 文档

[Win32 和 C++ 入门](https://learn.microsoft.com/zh-cn/windows/win32/learnwin32/learn-to-program-for-windows)

```c++
BOOL MoveWindow(HWND hWnd, int X, int Y, int nWidth, int nHeight, BOOL bRepaint);
```

# 入口函数

每个 Windows 程序都包含一个名为 WinMain 或 wWinMain 的入口点函数。 下面是 wWinMain 的签名。

```c++
/**
参数:
  hInstance 称为“实例句柄”或“模块句柄”。操作系统使用此值在内存中加载可执行文件时标识可执行文件 (EXE) 。 某些Windows函数需要实例句柄，例如加载图标或位图。
  hPrevInstance 没有意义。 它在 16 位Windows中使用，但现在始终为零。
  pCmdLine 包含命令行参数作为 Unicode 字符串。
  nCmdShow 是一个标志，指示主应用程序窗口是最小化、最大化还是正常显示。
返回: 返回 int 值。 操作系统不使用返回值，但可以使用返回值将状态代码传达给你编写的其他程序。
WINAPI: 是调用约定。 调用约定定义函数如何从调用方接收参数
*/
int WINAPI wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PWSTR pCmdLine, int nCmdShow);

INT WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance,
    PSTR lpCmdLine, INT nCmdShow)
{
    return 0;
}

```

# dll

- 控制台程序 Console
  - DOS 程序，本身没有窗口，通过 Windows DOS 窗口执行
- 窗口程序
  - 拥有自己的窗口，可以与用户交互
- 库程序——无法独立执行
  - 存放代码、数据的程序，执行文件可以从中取出代码执行和获取数据
    - 静态库程序：扩展名 LIB，在编译链接程序时，将代码放入到执行文件中，没有入口
    - 动态库程序：扩展名 DLL，在执行文件执行时从中获取代码，有入口，但依附其他程序执行

编译工具：

- 编译器 CLE.EXE 将源代码编译成目标代码 obj
- 链接器 LINK.EXE 将目标代码、库链接生成最终文件
- 资源编译器 RC.EXE (.rc)将资源编译，最终通过链接器存入最终文件

路径：VS/bin

Windows 库

- kernel32.dll 核心 api,如，进程、线程、内存管理等
- user32.dll 提供了窗口、消息等 API
- gdi32.dll 绘图相关的 api

路径：c:\windows\System32
Kernel32.dll 这个 dll 扩展出口于进程、内存、硬件、文件系统配置有关。病毒程序从这些 dll 文件中引入 API 函数，传输文件系统、内存以及进程相关配置。

Advapi32.dll 这是一个与系统服务以及注册表有关的函数。病毒程序通过使用这个 dll 中的函数来传输系统服务以及注册表相关的配置。

Gdi32.dll 有关图形显示的扩展函数库。

User32.dll 这个库的函数可以用来创建和操纵 windows 用户的洁面组建，例如窗口、桌面、菜单、消息通知、告警等等。一些病毒程序使用这个 dll 的函数执行 DLL 注入，键盘记录，鼠标记录。

msvcrt.dll 包含了 c 语言的标准库函数的执行库。

Ws2_32.dll 和 wsock32.dll 他们呢包含网络连接相关的函数。病毒通过引入这些 dll 的函数用来执行网络相关的任务。

wininet.dll 这个展示使用 http 和 ftp 协议的高级函数。

urlmon.dll 这是一个 wininet.dll 的包装，它通常用来 MIME 类型连接和下载网络内容。恶意程序 downloaders 使用这个库里的函数用来下载新病毒程序内容。

NTDLL.dll 扩展 windows 本地 API 函数和行为作为在用户程序及核心之间的转换器。例如，当一个程序在 kernel32.dll（或 kernelbase.dll）调用了 API 函数，API 作为返回调用一个短票据在 ntdll.dll。程序通常不会直接从 ntdll.dll 引用函数；ntdll.dll 中的函数通常被间接的被如 kernel32.dll 的 dll 调用。ntdll.dll 中的函数通常都是无文档的。病毒程序作者有时直接引用此 dl 中的函数。
