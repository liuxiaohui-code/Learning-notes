# 网络

常用的网络分析工具

## telnet

Telnet 协议是 TCP/IP 协议家族中的一员，是 Internet 远程登陆服务的标准协议和主要方式。它为用户提供了在本地计算机上完成远程主机工作的能力。在终端使用者的电脑上使用 telnet 程序，用它连接到服务器。终端使用者可以在 telnet 程序中输入命令，这些命令会在服务器上运行，就像直接在服务器的控制台上输入一样。可以在本地就能控制服务器。要开始一个 telnet 会话，必须输入用户名和密码来登录服务器。Telnet 是常用的远程控制 Web 服务器的方法。

```sh
# 测试 ip 与 port 是否可以访问
telnet <ip> <port>
```

命令行内：

```sh
c    - close                    关闭当前连接
d    - display                  显示操作参数
o    - open hostname [port]     连接到主机(默认端口 23)。
q    - quit                     退出 telnet
set  - set                      设置选项(键入 'set ?' 获得列表)
sen  - send                     将字符串发送到服务器
st   - status                   打印状态信息
u    - unset                    解除设置选项(键入 'set ?' 获得列表)
?/h  - help                     打印帮助信息
```
## 证书服务

Certutil.exe 是作为证书服务的一部分安装的命令行工具。 你可以使用 certutil.exe 显示证书颁发机构 (CA) 配置信息、配置证书服务、备份和还原 CA 组件。 该计划还验证证书、密钥对和证书链。

如果不结合其他参数对证书颁发机构运行 certutil，则将显示当前证书颁发机构配置。 如果不结合其他参数对非证书颁发机构运行 certutil，则命令默认为运行 certutil -dump 命令。 并非所有版本的 certutil 都提供本文档介绍的所有参数和选项。 可以通过运行 `certutil -?` 或 `certutil <parameter> -? `来查看你的 certutil 版本提供的选项。

```bat
:: 查看文件的md5值
certutil -hashfile "<文件的绝对路径>" md5
```

## ipconfig ip 适配器信息

```bat
:: 查看电脑ip
ipconfig [/allcompartments] [选项]

选项:
       /?               显示此帮助消息
       /all             显示完整配置信息。
       /release         释放指定适配器的 IPv4 地址。
       /release6        释放指定适配器的 IPv6 地址。
       /renew           更新指定适配器的 IPv4 地址。
       /renew6          更新指定适配器的 IPv6 地址。
       /flushdns        清除 DNS 解析程序缓存。
       /registerdns     刷新所有 DHCP 租用并重新注册 DNS 名称
       /displaydns      显示 DNS 解析程序缓存的内容。
       /showclassid     显示适配器允许的所有 DHCP 类 ID。
       /setclassid      修改 DHCP 类 ID。
       /showclassid6    显示适配器允许的所有 IPv6 DHCP 类 ID。
       /setclassid6     修改 IPv6 DHCP 类 ID。
ipconfig                       ... 显示信息
ipconfig /all                  ... 显示详细信息
ipconfig /renew                ... 更新所有适配器
ipconfig /renew EL*            ... 更新所有名称以 EL 开头的连接
ipconfig /release *Con*        ... 释放所有匹配的连接，例如“有线以太网连接 1”或“有线以太网连接 2”
ipconfig /allcompartments      ... 显示有关所有隔离舱的信息
ipconfig /allcompartments /all ... 显示有关所有隔离舱的详细信息
```

## ping 网络联通
```sh
# 访问服务器的ip的22端口
ping <ip>
```

## nslookup dns 解析

## tracert 路由追踪

## netsh 连接情况

## netstat 协议统计与 tcp/ip 信息
```sh
-a (all)显示所有选项，默认不显示LISTEN相关
-t (tcp)仅显示tcp相关选项
-u (udp)仅显示udp相关选项
-n 拒绝显示别名，能显示数字的全部转化成数字。
-l 仅列出有在 Listen (监听) 的服務状态

-p 显示建立相关链接的程序名
-r 显示路由信息，路由表
-e 显示扩展信息，例如uid等
-s 按各个协议进行统计
-c 每隔一个固定时间，执行该netstat命令。

# netstat –apn
# netstat -ntlp
```
## linux-访问控制-防火墙


```sh
#centos7
# 查看是否开启
systemctl status firewalld.service
# 打开防火墙
systemctl start firewalld.service
# 停用防火墙
systemctl disable firewalld
# 禁用防火墙
systemctl stop firewalld.service
# 开机启动
systemctl enable firewalld
# 取消开机启动
systemctl disable firewalld
# 更新防火墙规则方法1:无需断开连接，动态更改规则
firewall-cmd --reload
# 更新防火墙规则方法2:断开连接，以重启的方式更改规则
firewall-cmd --complete-reload
# 查看运行状态
firewall-cmd --state
# 查看接口信息
firewall-cmd --list-all
# 查看帮助
firewall-cmd --help
--zone=NAME # 指定 Zone
--permanent # 为永久生效
--timeout=seconds # 持续一段时间，到期后自动移除，经常用于调试，且不能与 --permanent 同时使用
#显示已开放端口
firewall-cmd --permanent --zone=public --list-ports
# 查看是否开启80端口
firewall-cmd --zone=public --query-port=80/tcp
# 开启80端口
firewall-cmd --zone=public --add-port=80/tcp --permanent
# 追加一段端口范围
firewall-cmd --add-port=6000-6600/tcp
# 添加eth0 接口至 public 信任等级，永久有效
firewall-cmd --zone=public --add-interface=eth0 --permanent
# 配置 public zone 的端口转发
firewall-cmd --zone=public --add-masquerade
# 然后转发 tcp 22 端口至 9527
firewall-cmd --zone=public --add-forward-port=port=22:proto=tcp:toport=9527
# 转发 22 端口数据至另一个 ip 的相同端口上
firewall-cmd --zone=public --add-forward-port=port=22:proto=tcp:toaddr=192.168.1.123
# 转发 22 端口数据至另一 ip 的 9527 端口上
firewall-cmd --zone=public --add-forward-port=port=22:proto=tcp:toport=9527:toaddr=192.168.1.100
# IP 封禁
firewall-cmd --permanent --add-rich-rule="rule family='ipv4' source address='192.168.1.123' reject"
# 通过 ipset 来封禁 ip
firewall-cmd --permanent --zone=public --new-ipset=blacklist --type=hash:ip
firewall-cmd --permanent --zone=public --ipset=blacklist --add-entry=192.168.1.123
# 封禁网段
firewall-cmd --permanent --zone=public --new-ipset=blacklist --type=hash:net
firewall-cmd --permanent --zone=public --ipset=blacklist --add-entry=192.168.1.0/24
# 倒入 ipset 规则 blacklist，然后封禁 blacklist
firewall-cmd --permanent --zone=public --new-ipset-from-file=/path/blacklist.xml
firewall-cmd --permanent --zone=public --add-rich-rule='rule source ipset=blacklist drop'
```
## linux-访问控制-tcpd服务器

tcpd服务器配置,tcpd服务器可以控制外部IP对本机服务的访问

`/etc/hosts.allow`控制可以访问本机的IP地址

`/etc/hosts.deny`控制禁止访问本机的IP

配置有冲突时,以`/etc/hosts.allow`的配置为准

配置生效: `service xinetd restart`

```sh
#服务进程名:主机列表:当规则匹配时可选的命令操作
server_name:hosts-list[:command]

vsftpd:10.76.74.24:allow
vsftpd:10.76.74.43:allow

sshd:all:deny
# 允许全部
all:all
```

