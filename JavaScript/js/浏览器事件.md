# 事件

事件就是浏览器中发生的事儿，比如点击按钮、加载页面、播放视频，等等，我们可以通过调用代码来响应事件。 侦听事件发生的结构称为**事件监听器（Event Listener）**，响应事件触发而运行的代码块被称为**事件处理器（Event Handler）**。

​ HTML 属性等价于对许多事件处理程序的属性；但是，你不应该使用这些 —— 他们被认为是不好的做法。

## 增加/删除事件监听器

```js
addEventListener(type, listener, options)
addEventListener(type, listener, useCapture )
removeEventListener(type, listener, options)
removeEventListener(type, listener, useCapture )

type: 事件类型, string, "click"
listener: function(event){}
options: {
  capture: false, //表示 listener 会在该类型的事件捕获阶段传播到该 EventTarget 时触发。
  once: false, //表示 listener 在添加之后最多只调用一次,如果为 true,listener 会在其被调用之后自动移除
  passive: false, //设置为 true 时,表示 listener 永远不会调用 preventDefault()
  signal:AbortSignal
}
useCapture:false,//是否为捕获监听器。默认值为 false
```

```js
const btn = document.querySelector("button")

function bgChange() {
	const rndCol = "rgb(" + random(255) + "," + random(255) + "," + random(255) + ")"
	document.body.style.backgroundColor = rndCol
}

btn.addEventListener("click", bgChange)
// 相当于
btn.onClick = bgChange
// 移除事件监听器
btn.removeEventListener("click", bgChange)
//给同一个监听器注册多个处理器
//1 错误做法，只有最后一个生效
myElement.onclick = functionA
myElement.onclick = functionB
//2.正确做法
myElement.addEventListener("click", functionA)
myElement.addEventListener("click", functionB)
```

> -   事件处理程序属性功能和选项会更少，但是具有更好的跨浏览器兼容性(在 Internet Explorer 8 的支持下)，您应该从这些开始学起。
> -   DOM Level 2 Events (`addEventListener()`, etc.) 更强大，但也可以变得更加复杂，并且支持不足（只支持到 Internet Explorer 9）。 但是您也应该尝试这个方法，并尽可能地使用它们。

## 事件对象

​ 在事件处理函数内部，一个固定指定名称的参数，例如`event`，`evt`或简单的`e`。 这被称为**事件对象**，它被自动传递给事件处理函数，以提供额外的功能和信息。

```js
e.target:obj   //指的是元素本身
e.preventDefault();//阻止默认事件, return false;可以达到同样的目的
```

## 事件的冒泡与捕获

冒泡:事件会从目标节点流向文档根节点，途中会经过目标节点的各个父级节点，并在这些节点上触发捕获事件，直至到达文档的根节点。整个过程就像水中的气泡一样，从水底向上运动。
捕获:事件从文档根节点（Document 对象）流向目标节点，途中会经过目标节点的各个父级节点，并在这些节点上触发捕获事件，直至到达事件的目标节点；先
后来，W3C 为了统一标准，采用了一个折中的方式，即将事件捕获与事件冒泡合并，也就是现在的“先捕获后冒泡”

当一个事件发生在具有父元素的元素上(例如，在我们的例子中是`<video>`元素)时，现代浏览器运行两个不同的阶段 - 捕获阶段和冒泡阶段。 在捕获阶段：

-   浏览器检查元素的最外层祖先`<html>`，是否在捕获阶段中注册了一个`onclick`事件处理程序，如果是，则运行它。
-   然后，它移动到`<html>`中单击元素的下一个祖先元素，并执行相同的操作，然后是单击元素再下一个祖先元素，依此类推，直到到达实际点击的元素。

在冒泡阶段，恰恰相反:

-   浏览器检查实际点击的元素是否在冒泡阶段中注册了一个`onclick`事件处理程序，如果是，则运行它
-   然后它移动到下一个直接的祖先元素，并做同样的事情，然后是下一个，等等，直到它到达`<html>`元素。

在现代浏览器中，默认情况下，所有事件处理程序都在冒泡阶段进行注册。

```js
//当在事件对象上调用该函数时，它只会让当前事件处理程序运行，但事件不会在冒泡链上进一步扩大，因此将不会有更多事件处理器被运行(不会向上冒泡)。
e.stopPropagation()
```

## 事件委派

事件委派的定义就是，把原来加给子元素身上的事件绑定在父元素身上，就是把事件委派给父元素。
原理: 事件冒泡,点击子元素,触发父元素的点击事件,通过`event.target`获取触发的子元素

```HTML
<ul id="ul1" >
  <li>111</li>
  <li>222</li>
  <li>333</li>
  <li>444</li>
</ul>
<script>
  // 给每个li添加事件
var li=document.getElementsByTagName('li');
function A(){
    alert(li.innerHTML);
};
li.click=A;


// 事件委派
var ul=document.getElementById('ul1')
var target = ul.target || ul.srcElement; //兼容处理
alert(target.innerHTML);

</script>


```

# window 窗口事件

针对 window 对象触发的事件（应用到 `<body>` 标签）

```sh
attribute		value	describe
#---------------------------文档----------
onafterprint	script	文档打印之后运行的脚本。
onbeforeprint	script	文档打印之前运行的脚本。
onbeforeunload	script	文档卸载之前运行的脚本。
onhaschange		script	当文档已改变时运行的脚本。
onoffline		script	当文档离线时运行的脚本。
ononline		script	当文档上线时运行的脚本。
onredo			script	当文档执行撤销（redo）时运行的脚本。
onundo			script	在文档执行 undo 时运行的脚本。
#--------------------错误------------------
onerror			script	在错误发生时运行的脚本。
#----------------页面加载-----------------------
onload			script	页面结束加载之后触发。
onunload		script	一旦页面已下载时触发（或者浏览器窗口已被关闭）。
#----------------消息触发-----------------------
onmessage		script	在消息被触发时运行的脚本。
#----------------窗口-----------------------
onpagehide		script	当窗口隐藏时运行的脚本。
onpageshow		script	当窗口成为可见时运行的脚本。
onpopstate		script	当窗口历史记录改变时运行的脚本。
onresize		script	当浏览器窗口被调整大小时触发。
#----------------缓存-----------------------
onstorage		script	在 Web Storage 区域更新后运行的脚本。
```

## vue监听关闭浏览器并发送 ajax

1. 增加监听器`beforeunload` `unload`
2. 先后触发时间小于等于 5ms,为关闭窗口;否则为刷新
3. ajax 请求必须为同步

```js
mounted() {
      window.addEventListener('beforeunload', e => this.beforeunloadHandler(e))
      window.addEventListener('unload', e => this.unloadHandler(e))
    },
    destroyed() {
      window.removeEventListener('beforeunload', e => this.beforeunloadHandler(e))
      window.removeEventListener('unload', e => this.unloadHandler(e))
    },
    methods: {
      beforeunloadHandler(){
        this._beforeUnload_time=new Date().getTime();
      },
      unloadHandler(e){
        this._gap_time=new Date().getTime()-this._beforeUnload_time;
        debugger
        //判断是窗口关闭还是刷新
        if(this._gap_time<=5){
          //如果是登录状态，关闭窗口前，移除用户
          if(!this.showLoginButton){
            $.ajax({
              url: '/pictureweb/user/remove',
              type: 'get',
              async:false, //或false,是否异步

            })
          }
        }
      },
}
```

# form 表单事件

由 HTML 表单内的动作触发的事件（应用到几乎所有 HTML 元素，但最常用在 form 元素中）

```sh
attribute		value	describe
#--------------焦点-------------------------
onfocus			script	当元素获得焦点时运行的脚本。
onblur			script	元素失去焦点时运行的脚本。
#表单
onformchange	script	在表单改变时运行的脚本。
onforminput		script	当表单获得用户输入时运行的脚本。
onsubmit		script	在提交表单时触发。
#元素
onchange		script	在元素值被改变时运行的脚本。
oncontextmenu	script	当上下文菜单被触发时运行的脚本。
oninput			script	当元素获得用户输入时运行的脚本。
oninvalid		script	当元素无效时运行的脚本。
onselect		script	在元素中文本被选中后触发。
#
onreset			script	当表单中的重置按钮被点击时触发。HTML5 中不支持。
```

# keyboard 键盘事件

```
onkeydown		script	在用户按下按键时触发。
onkeypress		script	在用户敲击按钮时触发。
onkeyup			script	当用户释放按键时触发。
```

# mouse 鼠标事件

```
onclick			script	元素上发生鼠标点击时触发。
ondblclick		script	元素上发生鼠标双击时触发。
onmousedown		script	当元素上按下鼠标按钮时触发。
onmouseup		script	当在元素上释放鼠标按钮时触发。

ondrag			script	元素被拖动时运行的脚本。
ondragend		script	在拖动操作末端运行的脚本。
ondragenter		script	当元素元素已被拖动到有效拖放区域时运行的脚本。
ondragleave		script	当元素离开有效拖放目标时运行的脚本。
ondragover		script	当元素在有效拖放目标上正在被拖动时运行的脚本。
ondragstart		script	在拖动操作开端运行的脚本。
ondrop			script	当被拖元素正在被拖放时运行的脚本。


onmousemove		script	当鼠标指针移动到元素上时触发。
onmouseout		script	当鼠标指针移出元素时触发。
onmouseover		script	当鼠标指针移动到元素上时触发。

onmousewheel	script	当鼠标滚轮正在被滚动时运行的脚本。
onscroll		script	当元素滚动条被滚动时运行的脚本。
```

-   **注释：**onmousedown 、onmousemove 、onmouseout 、onmouseover、onmouseup 属性不适用以下元素：<base>、<bdo>、<br>、<head>、<html>、<iframe>、<meta>、<param>、<script>、<style> 或 <title>。

# media 媒体事件

由媒介（比如视频、图像和音频）触发的事件（适用于所有 HTML 元素，但常见于媒介元素中，比如 <audio>、<embed>、<img>、<object> 以及 <video>）:

```
onabort				script	在退出时运行的脚本。
oncanplay			script	当文件就绪可以开始播放时运行的脚本（缓冲已足够开始时）。
oncanplaythrough	script	当媒介能够无需因缓冲而停止即可播放至结尾时运行的脚本。
ondurationchange	script	当媒介长度改变时运行的脚本。
onemptied			script	当发生故障并且文件突然不可用时运行的脚本（比如连接意外断开时）。
onended				script	当媒介已到达结尾时运行的脚本（可发送类似“感谢观看”之类的消息）。
onerror				script	当在文件加载期间发生错误时运行的脚本。
onloadeddata		script	当媒介数据已加载时运行的脚本。
onloadedmetadata	script	当元数据（比如分辨率和时长）被加载时运行的脚本。
onloadstart			script	在文件开始加载且未实际加载任何数据前运行的脚本。
onpause				script	当媒介被用户或程序暂停时运行的脚本。
onplay				script	当媒介已就绪可以开始播放时运行的脚本。
onplaying			script	当媒介已开始播放时运行的脚本。
onprogress			script	当浏览器正在获取媒介数据时运行的脚本。
onratechange		script	每当回放速率改变时运行的脚本（比如当用户切换到慢动作或快进模式）。
onreadystatechange	script	每当就绪状态改变时运行的脚本（就绪状态监测媒介数据的状态）。
onseeked			script	当 seeking 属性设置为 false（指示定位已结束）时运行的脚本。
onseeking			script	当 seeking 属性设置为 true（指示定位是活动的）时运行的脚本。
onstalled			script	在浏览器不论何种原因未能取回媒介数据时运行的脚本。
onsuspend			script	在媒介数据完全加载之前不论何种原因终止取回媒介数据时运行的脚本。
ontimeupdate		script	当播放位置改变时（比如当用户快进到媒介中一个不同的位置时）运行的脚本。
onvolumechange		script	每当音量改变时（包括将音量设置为静音）时运行的脚本。
onwaiting			script	当媒介已停止播放但打算继续播放时（比如当媒介暂停已缓冲更多数据）运行脚本
```
